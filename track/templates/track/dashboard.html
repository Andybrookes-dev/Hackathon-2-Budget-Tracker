{% extends "base.html" %} {% block content %} {% if messages %}
<p class="messages text-white bg-success text-center p-2">
    {% for message in messages %} {{ message }} {% endfor %}
</p>
{% endif %}
<h1 class="text-center">{{request.user.username|upper}} 's Dashboard</h1>
<h2>Expenses</h2>
<div class="mb-4" style="border: 1px solid #ccc; padding: 10px">
    {% for item in transaction_summary %}
    <p>{{ item.transaction_type|title }} : £{{ item.total_amount }}</p>
    {% empty %}
    <p>No transactions yet.</p>
    {% endfor %}
    <a href="{% url 'budget' %}" class="btn btn-sm btn-success p-2"
        >Go to Budget</a
    >
</div>

<h2>Budgets</h2>
{% for budget in budgets %}
<div class="mb-4" style="border: 1px solid #ccc; padding: 10px">
    <h3>{{ budget.title }}</h3>
    <!--<p>My budget Limit: £{{ budget.limit_amount }}</p>
    <p>Spent:£ {{ budget.spent_amount }}</p>
    <p>Remaining: £{{ budget.remaining_amount }}</p>-->
    {% if budget.is_over_limit %}
    <p class="text-white bg-danger p-2">
        your budget limit for {{budget.transaction_type}} is £{{
        budget.limit_amount }}.you spent Over the budget! you spent {{
        budget.spent_amount }}
    </p>
    {% elif budget.spent_amount == budget.limit_amount %}
    <p class="text-dark bg-warning p-2">
        your budget limit for {{budget.transaction_type}} is £{{
        budget.limit_amount }}. you have reached your budget limit. you spent {{
        budget.spent_amount }}
    </p>
    {% else %}
    <p class="text-white bg-success p-2">
        your budget limit for {{budget.transaction_type}} is £{{
        budget.limit_amount }}.you spent within budget. you spent {{
        budget.spent_amount }}
    </p>
    {% endif %}
</div>
{% empty %}
<p>No budgets yet.</p>
{% endfor %}

<hr />

<h2>Transactions</h2>
{% for transaction in transactions %}
<div style="border: 1px solid #ccc; padding: 10px; margin-bottom: 5px">
    <p>
        <strong>{{ transaction.title }}</strong>
        ({{transaction.transaction_type }}) - £{{ transaction.amount }} on {{
        transaction.date }}
    </p>
    <p>
        <a
            href="{% url 'edit_transaction' transaction.pk %}"
            class="btn btn-sm btn-success"
            >Edit</a
        >
        |

        <a
            href="{% url 'delete_transaction' transaction.pk %}"
            class="btn btn-sm btn-danger"
            data-bs-toggle="modal"
            data-bs-target="#deleteTransactionModal{{ transaction.id }}"
        >
            Delete
        </a>
    </p>
</div>
<!-- Delete Confirmation Modal -->
<div
    class="modal fade"
    id="deleteTransactionModal{{ transaction.id }}"
    tabindex="-1"
    aria-hidden="true"
>
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Confirm Delete</h5>
                <button
                    type="button"
                    class="btn-close"
                    data-bs-dismiss="modal"
                    aria-label="Close"
                ></button>
            </div>
            <form
                method="POST"
                action="{% url 'delete_transaction' transaction.id %}"
            >
                {% csrf_token %}
                <div class="modal-body">
                    <p>
                        Are you sure you want to delete the transaction
                        <strong>{{ transaction.title }}</strong>?
                    </p>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-danger">
                        Yes, Delete
                    </button>
                    <button
                        type="button"
                        class="btn btn-secondary"
                        data-bs-dismiss="modal"
                    >
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% empty %}
<p>No transactions yet.</p>

{% endfor %} {% endblock %}
